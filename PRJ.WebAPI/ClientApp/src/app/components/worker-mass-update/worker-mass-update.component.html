


   <!-- Content -->
<div class="w-100 page-container container-fluid d-flex justify-content-between align-content-center border rounded shadow bg-white px-4">
    
    

    <div class="mainContent d-flex flex-wrap justify-content-between align-content-start mt-4 w-100 border shadow-sm rounded mb-2 p-2">
        <div class="servicesList w-100 d-flex justify-content-between align-items-center ">
          <div class="servicesList d-flex justify-content-end align-items-center ">
            <button class="btn btn btn-success m-1 pr-3" 
            data-bs-toggle="modal"
            data-bs-target="#ExportExcel"
            >Export Excel</button> 
            <button class="btn btn btn-gold pr-3" data-bs-toggle="modal"
            data-bs-target="#transferWorker" > Import Excel  </button>
          </div>  
          <button class="btn btn-gold" (click)="back()">Back</button>
            
        </div>
        
        <div class="row w-100 my-1 p-2">
          <form [formGroup]="SubmitForm">
            <div class="row p-3 w-100 py-2 d-flex" style="background:#ececec">
                
              <div class="col-3 px-1 mb-3">
                <label for="entity" class="mx-1"
                  >{{ "entity" | translate }}
                  <span class="text-danger valdiation-text">*</span></label
                >
                <p-dropdown
                  [options]="EntityList"
                  [(ngModel)]="objData.Entity"
                  optionLabel="entityNameEn"
                  [filter]="true"
                  filterBy="entityNameEn,entityNameAr"
                  [showClear]="true"
                  placeholder="{{ '--Select--' | translate }}"
                  #entity
                  (onChange)="getFacilityProfileByEntityId(entity.value.id)"
                  styleClass="w-100 "
                  formControlName="Entity"
                  [disabled]="true"

                >
                  <ng-template pTemplate="selectedItem">
                    <div class="country-item country-item-value" *ngIf="entity">
                      <div>
                        {{
                          lang == "en"
                            ? entity.value.entityNameEn
                            : entity.value.entityNameAr
                        }}
                      </div>
                    </div>
                  </ng-template>
                  <ng-template let-r pTemplate="item">
                    <div class="country-item">
                      <div>
                        {{ lang == "en" ? r?.entityNameEn : r?.entityNameAr }}
                      </div>
                    </div>
                  </ng-template>
                  
                </p-dropdown>
                <div *ngIf="SubmitForm.controls['Entity'].errors && SubmitForm.controls['Entity'].touched" class="form-text d-block text-danger">
                  ({{ "Workers.ValidEntity" | translate }})
                </div>
              </div>
              
              <div class=" col-3 px-1 mb-3">
                <label for="facility" class="mx-1">
                  {{ "facility" | translate }}
                  <span class="text-danger valdiation-text">*</span></label
                >
                <p-dropdown
                  [options]="Facilities"
                  [(ngModel)]="objData.Facility"
                  optionLabel="facilityNameEn"
                  [filter]="true"
                  filterBy="facilityNameEn,facilityNameAr"
                  [showClear]="true"
                  placeholder="{{ '--Select--' | translate }}"
                  #facility
                  styleClass="w-100 "
                  (onChange)="getLicenseByFacilityId(facility.value.id)"
                  formControlName="Facility"
                  [disabled]="true"

                >
                  <ng-template pTemplate="selectedItem">
                    <div class="country-item country-item-value" *ngIf="facility">
                      <div>
                        {{
                          lang == "en"
                            ? facility.value.facilityNameEn
                            : facility.value.facilityNameAr
                        }}
                      </div>
                    </div>
                  </ng-template>
                  <ng-template let-r pTemplate="item">
                    <div class="country-item">
                      <div>
                        {{ lang == "en" ? r?.facilityNameEn : r?.facilityNameAr }}
                      </div>
                    </div>
                  </ng-template>
                </p-dropdown>
                <div *ngIf="SubmitForm.controls['Facility'].errors && SubmitForm.controls['Facility'].touched" class="form-text d-block text-danger">
                  ({{ "Workers.ValidFacility" | translate }})
                </div>
              </div>

              <div class=" col-3 px-1 mb-3">
                <label for="license" class="mx-1">
                  {{ "Workers.License" | translate }}
                  <span class="text-danger valdiation-text">*</span></label
                >
                <p-dropdown
                  [options]="LicenseList"
                  [(ngModel)]="objData.License"
                  optionLabel="licenseDescEn"
                  [filter]="true"
                  filterBy="licenseDescEn,licenseDescAr"
                  [showClear]="true"
                  placeholder="{{ '--Select--' | translate }}"
                  #license
                  styleClass="w-100 "
                  (onChange)="getPractiseByLicenseId(license.value.id)"
                  formControlName="License"
                  [disabled]="true"

                >
                  <ng-template pTemplate="selectedItem">
                    <div class="country-item country-item-value" *ngIf="license">
                      <div>
                        {{
                          lang == "en"
                            ? license.value.licenseDescEn
                            : license.value.licenseDescAr
                        }}
                      </div>
                    </div>
                  </ng-template>
                  <ng-template let-r pTemplate="item">
                    <div class="country-item">
                      <div>
                        {{ lang == "en" ? r?.licenseDescEn : r?.licenseDescAr }}
                      </div>
                    </div>
                  </ng-template>
                </p-dropdown>
                <div *ngIf="SubmitForm.controls['License'].errors && SubmitForm.controls['License'].touched" class="form-text d-block text-danger">
                  ({{ "Workers.ValidFacility" | translate }})
                </div>
              </div>

              <div class="col-3 px-1 mb-3">
                <label for="license" class="mx-1">
                  {{ "Workers.Practise" | translate }}
                  <span class="text-danger valdiation-text">*</span></label
                >
                <p-dropdown
                  [options]="PractiseList"
                  [(ngModel)]="objData.Practise"
                  optionLabel="practiseNameEn"
                  [filter]="true"
                  filterBy="practiseNameEn,practiseNameAr"
                  [showClear]="true"
                  placeholder="{{ '--Select--' | translate }}"
                  #Practise
                  styleClass="w-100 "
                  (onChange)="getPractiseByLicenseId(Practise.value.id)"
                  formControlName="Practise"
                  [disabled]="true"
                >
                  <ng-template pTemplate="selectedItem">
                    <div class="country-item country-item-value" *ngIf="Practise">
                      <div>
                        {{
                          lang == "en"
                            ? Practise.value.practiseNameEn
                            : Practise.value.practiseNameAr
                        }}
                      </div>
                    </div>
                  </ng-template>
                  <ng-template let-r pTemplate="item">
                    <div class="country-item">
                      <div>
                        {{ lang == "en" ? r?.practiseNameEn : r?.practiseNameAr }}
                      </div>
                    </div>
                  </ng-template>
                </p-dropdown>
                <div *ngIf="SubmitForm.controls['Practise'].errors && SubmitForm.controls['Practise'].touched" class="form-text d-block text-danger">
                  ({{ "Workers.ValidFacility" | translate }})
                </div>
              </div>
          
           </div>
</form>
        </div>
        <div class="row w-100 my-1 p-2">
        <div class="col-4 px-1 mb-3">
          <label for="facility" class="mx-1">
            {{ "Years" | translate }}
            <span class="text-danger valdiation-text">*</span></label
          >
          <p-dropdown
            [options]="YearsList" 
            [(ngModel)]="selectedYearObj"
            optionLabel="fiscalYear"
            [filter]="true"
            filterBy="fiscalYear"
            [showClear]="true"
            placeholder="{{ '--Select--' | translate }}"
            #Years
            styleClass="w-100"
            (onChange)="SelectedYear(Years.value.fiscalYear)"
          >
            <ng-template pTemplate="selectedItem">
              <div class="country-item country-item-value" *ngIf="Years">
                <div>
                 
                    {{ Years.value.fiscalYear }}  
                 
                </div>
              </div>
            </ng-template>
            <ng-template let-r pTemplate="item">
              <div class="country-item">
                <div>
                  {{ r?.fiscalYear }}
                </div>
              </div>
            </ng-template>
          </p-dropdown>
         
        </div>
        <div class="col-4 px-1 mb-3">
          <label for="facility" class="mx-1">
            {{ "Quarter" | translate }}
            <span class="text-danger valdiation-text">*</span></label
          >
          <p-dropdown
            [options]="QuarterList" 
            [(ngModel)]="selectedQuarterObj"
            optionLabel="quarterLongDescNtv"
            [filter]="true"
            filterBy="quarterLongDescNtv,quarterLongDescFrn"
            [showClear]="true"
            placeholder="{{ '--Select--' | translate }}"
            #quarter
            styleClass="w-100"
            (onChange)="SelectedQuarter(quarter.value.quarterCode)"
          >
            <ng-template pTemplate="selectedItem">
              <div class="country-item country-item-value" *ngIf="quarter">
                <div>
                 
                    {{ quarter.value.quarterLongDescNtv }}  
                 
                </div>
              </div>
            </ng-template>
            <ng-template let-r pTemplate="item">
              <div class="country-item">
                <div>
                  {{ r?.quarterLongDescNtv }}
                </div>
              </div>
            </ng-template>
          </p-dropdown>
         
        </div>
          </div>
        <div class="source-service-details d-flex justify-content-start flex-row-reverse align-items-start w-100">
            <div class="source-service-datatable w-100 my-3">
              <table datatable [dtOptions]="dtOptions" id="WorkersDataTable" class="table datatable table-responsive table-striped table-bordered row-border table-hover table-sm w-100 overflow-auto">
                <thead>
                  <tr>
                    <th class="select-filter">
                      #
                      </th>
                    <th class="select-filter">
                      {{ "Workers.WorkerName" | translate }}
                    </th>
                    <th class="select-filter">
                      {{ "Workers.nationalityId" | translate }}
                    </th>
                    <th class="select-filter">
                      {{ "Workers.Gender" | translate }}
                    </th>
                    <th class="select-filter">
                      {{ "Workers.DB" | translate }}
                    </th>
                    <th class="select-filter">
                      {{ "Workers.JobPosition" | translate }}
                    </th>
                    <th class="select-filter">
                      {{ "Workers.EmploymentStatus" | translate }}
                    </th>
                    <th class="select-filter">
                      <p *ngIf="QuarterNow == 1" style="color: ca9f45;"> Selected Quarter </p>
                      {{ "Workers.q1" | translate }}
                    </th>
                    <th class="select-filter">
                      <p *ngIf="QuarterNow == 2" style="color: ca9f45;"> Current Quarter </p>
                      {{ "Workers.q2" | translate }}
                    </th>
                    <th class="select-filter">
                      <p *ngIf="QuarterNow == 3" style="color: ca9f45;"> Current Quarter </p>
                      {{ "Workers.q3" | translate }}
                    </th>
                    <th class="select-filter">
                      <p *ngIf="QuarterNow == 4" style="color: ca9f45;"> Current Quarter </p>
                      {{ "Workers.q4" | translate }}
                    </th>
                  
                    <th>{{ "Workers.ThisYear" | translate }}</th>
                  </tr>
                </thead>
                <tbody *ngIf="radionuclides?.length != 0">
                  
                  <tr  *ngFor="let mem of radionuclides; let i = index">
                    <td style="width:20px">{{ i+1}}</td> 
                    <td>{{ lang == "en" ? mem.workerNameEn : mem.workerNameAr }}</td>
                    <td>{{ mem.nationalityId }}</td>
                    <td>{{ lang == "en" ? mem.genderEn : mem.genderAr }}</td>
                    <td> {{ mem.birthDate | date : 'dd/MM/yyyy' }} </td>
                    <td style="width:177px">  {{mem.jobPositionAr != null ? lang == "en" ? mem.jobPositionEn : mem.jobPositionAr : 'No previous readings'}}
                    </td>
                    <td>
                      {{mem.statusAr != null ? lang == "en" ? mem.statusAr: mem.statusAr  : 'No previous readings'}}
                    </td>
                    <td [class]="QuarterNow == 1 ? 'bg-bold-subtil' : ''">
                      <input type="hidden" value="mem.id">
                      <input *ngIf="mem.q1Value == 0 && QuarterNow == 1" class="form-control w-100" (keypress)="isNumberKey($event)" [(ngModel)]="mem.DeepDose" form placeholder="insert Dose Record" type="text">
                      <span *ngIf="mem.q1Value != 0">{{ mem.q1Value }} </span>
                    </td>
                    <td [class]="QuarterNow == 2 ? 'bg-bold-subtil' : ''">
                      <input *ngIf="mem.q2Value == 0 &&QuarterNow == 2" class="form-control w-100" (keypress)="isNumberKey($event)" [(ngModel)]="mem.DeepDose" form placeholder="insert Dose Record" type="text">
                      <span *ngIf="mem.q2Value != 0">{{ mem.q2Value }} </span>
                    </td>
                    <td [class]="QuarterNow == 3 ? 'bg-bold-subtil' : ''">
                      <input *ngIf="mem.q3Value == 0 && QuarterNow == 3" class="form-control w-100" (keypress)="isNumberKey($event)" [(ngModel)]="mem.DeepDose" form placeholder="insert Dose Record" type="text">
                      <span *ngIf="mem.q3Value != 0 ">{{ mem.q3Value }} </span>
                    </td>
                    <td [class]="QuarterNow == 4 ? 'bg-bold-subtil' : ''">
                      <input *ngIf="mem.q4Value == 0 && QuarterNow == 4" class="form-control w-100" (keypress)="isNumberKey($event)" [(ngModel)]="mem.DeepDose" form placeholder="insert Dose Record" type="text">
                      <span *ngIf="mem.q4Value != 0 ">{{ mem.q4Value }} </span>
                    </td>
                      <td class="bg-green-subtil text-center" >
                       <span> {{mem.q1Value + mem.q2Value + mem.q3Value + mem.q4Value | number:'1.1-4'}} </span>
                      </td>
                  </tr>
              
              </tbody>
              <tbody *ngIf="radionuclides?.length == 0">
                <tr>
                  <td colspan="12" class="no-data-available">
                    {{ "General.NoDataFound" | translate }}
                  </td>
                </tr>
              </tbody>
               <tfoot>
                  <tr>
                    <th></th>
                     <th>
                       
                     </th>
                     <th>
                       
                     </th>
                     <th>
                       
                     </th>
                     <th> </th>
                     <th></th>
                    
                     <th> </th>
                     <th> <button (click)="AddReadingWithDataTable()" *ngIf="QuarterNow == 1" class="btn btn-gold w-100"> 
                       save
                        </button></th>
                     <th> <button (click)="AddReadingWithDataTable()" *ngIf="QuarterNow == 2" class="btn btn-gold w-100"> 
                       save
                        </button></th> 
                     <th>  <button (click)="AddReadingWithDataTable()" *ngIf="QuarterNow == 3" class="btn btn-gold w-100"> 
                       save
                        </button></th>
                     <th>
                       <button (click)="AddReadingWithDataTable()" *ngIf="QuarterNow == 4" class="btn btn-gold w-100"> 
                      save
                       </button>
                       
                     
                   </th>
<th>

</th>                     
                   </tr>
                  <tr>
                   <th>
                    <input
                        class="search-input"
                        name=""
                        id=""
                        type="hidden"
                        placeholder="{{ 'Workers.WorkerNameAr' | translate }}"
                        style="width: 100%"
                      />
                   </th>
                    <th>
                      <input
                        class="search-input"
                        name="workerNameEn"
                        id="workerNameEn"
                        type="text"
                        placeholder="{{ 'Workers.WorkerNameAr' | translate }}"
                        style="width: 100%"
                      />
                    </th>
                    <th>
                      <input
                        class="search-input"
                        name="nationality"
                        id="nationality"
                        type="text"
                        placeholder="{{ 'Workers.nationalityId' | translate }}"
                        style="width: 100%"
                      />
                    </th>
                    <th>
                      <input
                        class="search-input"
                        name="gender"
                        id="gender"
                        type="text"
                        placeholder="{{ 'Workers.Gender' | translate }}"
                        style="width: 100%"
                      />
                    </th>
                    <th> <input
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="text"
                      placeholder="{{ 'Workers.DB' | translate }}"
                      style="width: 100%"
                    /></th>
                    <th> <input
                      class="search-input"
                      name="jobPosition"
                      id="jobPosition"
                      type="text"
                      placeholder="{{ 'Workers.JobPosition' | translate }}"
                      style="width: 100%"
                    /></th>
                   
                    <th> <input
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="text"
                      placeholder="{{ 'Workers.EmploymentStatus' | translate }}"
                      style="width: 100%"
                    /></th>
                    <th> <input
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="text"
                      placeholder="{{ 'Workers.q1' | translate }}"
                      style="width: 100%"
                    /></th>
                    <th>  <input
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="text"
                      placeholder="{{ 'Workers.q2' | translate }}"
                      style="width: 100%"
                    /></th> 
                    <th> 
                       <input
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="text"
                      placeholder="{{ 'Workers.q3' | translate }}"
                      style="width: 100%"
                    /></th>
                    <th>
                     
                       <input 
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="text"
                      placeholder="{{ 'Workers.q4' | translate }}"
                      style="width: 100%"
                    />
                    
                  </th>
                    <th>
                       <input
                      class="search-input"
                      name="nationality"
                      id="nationality"
                      type="hidden"
                      placeholder="{{ 'Workers.ThisYear' | translate }}"
                      style="width: 100%"
                    /></th>
                    
                  </tr>
                </tfoot>
              </table>

        
             
            </div> <!-- end of datatablediv-->
        </div>
        
    </div>

    
</div>


<div
class="modal modal-xl fade"
id="ExportExcel"
tabindex="-1"
aria-labelledby="transferWorkerLabel"
aria-hidden="true"
>
<form [formGroup]="ExportExcelFile" (ngSubmit)="ExportExcel()">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="transferWorkerLabel">Export Excel 
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          
        ></button>
      </div>
      <div class="modal-body">
        <div class="row w-100 "> 
          <div class="col-4">
            <label for="tofacility">Years</label>
            <select formControlName="year"
            class="form-select form-control-sm" 
            [(ngModel)]="selectedYearObj.fiscalYear"
          
            > 
            <!-- [attr.disabled]="true" -->
            <option value=""> -- select -- </option>
            <option *ngFor="let year of YearsList" [value]="year.fiscalYear">
              {{year.fiscalYear}}
               </option>
           
            </select>
            <!-- <div id="tofacilityHelp" class="form-text">
              Please Insert Employment Status
            </div> -->
          </div>
          <div class="col-4">
            <label>Quarter</label>
            <select 
            class="form-select form-control-sm"
            formControlName="quarter" 
            [(ngModel)]="QuarterNow"
            > 
            <option value=""> -- select -- </option>
              <option *ngFor="let q of QuarterList"  [value]="q.quarterCode"> 
                {{ lang == "en" ? q.quarterLongDescFrn : q.quarterLongDescNtv }} 
              </option>
            </select>
          </div>
          <div class="col-4">
         
          </div>
          
          <div class="col-2 mt-3">
            <button
            type="submit"
            class="btn btn-green btn-sm p-2 w-75"
            data-bs-dismiss="modal"
          >
            Export 
          </button>

          </div>
           
          <div class="col-10 mt-3">
          </div>
          <div class="col-12">
            <p class="text-center">
              قم باختيار السنة والربع الذي تنوي تعبئة قراءته قبل عمل استخراج للبيانات 
            </p>
            <hr>
          </div>
      
          <div class="col-12 mt-1" style="text-align-last: end;">
          <button
          type="button"
          class="btn btn-gold btn-sm"
          data-bs-dismiss="modal"
        >
          Close
        </button>
        </div>
      </div>
        </div>
      </div>
    
     
    </div>
  
</form>
</div>

<div
class="modal modal-xl fade"
id="transferWorker"
tabindex="-1"
aria-labelledby="transferWorkerLabel"
aria-hidden="true"
>
<form [formGroup]="importExcelFile" (ngSubmit)="onFormSubmit()">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="transferWorkerLabel">Employment Status
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="w-100 row">
          <div class="col-5 text-center pt-2 pb-2 mb-4">
            <div class="custom-file">
                <input type="file" formControlName="formFile" class="custom-file-input" id="customFile" name="myfile"
                    (change)="onFileSelect($event)" #UploadFileInput>
                <label class="custom-file-label" for="customFile">{{fileInputLabel || 'Choose File'}}</label>
            </div>
            <div *ngIf="importExcelFile.controls['formFile'].errors && importExcelFile.controls['formFile'].touched" class="form-text d-block text-danger">
              Please Insert Quarter
            </div>
        </div>
        <div class="col-7 text-center pt-2 pb-2"></div>
        
          
          <div class="col-4">
            <label for="tofacility">Years</label>
            <select formControlName="year"
            class="form-select form-control-sm" 
            > 
            <option value=""> -- select -- </option>
            <option *ngFor="let year of YearsList" [value]="year.fiscalYear">
              {{year.fiscalYear}}
               </option>
           
            </select>
            <!-- <div id="tofacilityHelp" class="form-text">
              Please Insert Employment Status
            </div> -->
            <div *ngIf="importExcelFile.controls['year'].errors && importExcelFile.controls['year'].touched" class="form-text d-block text-danger">
              Please Insert Year
            </div>
          </div>
          <div class="col-4">
            <label for="tofacility">Quarter</label>
            <select 
            
            class="form-select form-control-sm"
            formControlName="quarter" 
            > 
            <option value=""> -- select -- </option>
              <option *ngFor="let q of QuarterList"  [value]="q.quarterCode"> 
                {{ lang == "en" ? q.quarterLongDescFrn : q.quarterLongDescNtv }}
              </option>
            </select>
            <!-- <div id="tofacilityHelp" class="form-text">
              Please Insert Employment Status
            </div> -->
            <div *ngIf="importExcelFile.controls['quarter'].errors && importExcelFile.controls['quarter'].touched" class="form-text d-block text-danger">
              Please Insert Quarter
            </div>
          </div>
    
        
          <div class="col-4 mt-4">
            <button
            type="submit"
            class="btn btn-gold btn-sm p-2 w-75"
            
          >
            Upload 
          </button>
          </div>
        </div>
      </div>
      <div class="modal-body" *ngIf="problemsImportActive" >
        <div class="col-12 pb-1 pt-1">
          <hr>
          <h5 class="modal-title" id="transferWorkerLabel"> Problems Or Notes :
          </h5>
        </div>
        <div class="row w-100"> 
          <div class="col-12 pb-1 pt-1">

          <table
          class="table datatable table-responsive table-striped table-bordered row-border table-hover table-sm w-100 overflow-auto"
        >   
        <thead>       <tr> 
            <th> 
             #
            </th>
            <th> 
             User Id  
            </th>
            <th> 
              Problem
            </th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let Problem of problemsImport;let i = index">
            <td> 
             {{i+1}} 
            </td>
            <td> 
              {{Problem.userId}}
            </td>
            <td> 
              {{Problem.problem}}
            </td>
          </tr>
        </tbody>
         </table>
         </div>
        </div>
      </div>
      <div class="modal-footer">
       
        <button
          type="button"
          class="btn btn-gold btn-sm"
          data-bs-dismiss="modal"
          (click)="emptyProblem()"
        >
          Close
        </button>
     
      </div>
      
     
    </div>
  </div>
</form>
</div>